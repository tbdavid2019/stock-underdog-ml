# Stock Prediction Application

AI é©…å‹•çš„è‚¡ç¥¨é æ¸¬ç³»çµ±ï¼Œä½¿ç”¨ **LSTM** é æ¸¬ä¸‹ä¸€å€‹äº¤æ˜“æ—¥çš„è‚¡åƒ¹ã€‚

[![Python 3.11+](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## ğŸ“š å¿«é€Ÿå°èˆª

- **[SETUP.md](SETUP.md)** - å®Œæ•´å®‰è£æŒ‡å—ï¼ˆæ–°ç”¨æˆ¶å¿…è®€ï¼‰
- **[CHANGELOG.md](CHANGELOG.md)** - ç‰ˆæœ¬æ›´æ–°è¨˜éŒ„
- **[backtest/](backtest/)** - å›æ¸¬ç³»çµ±èªªæ˜
- **[scripts/](scripts/)** - æ¸¬è©¦å’Œç¶­è­·è…³æœ¬
- **[.env.example](.env.example)** - ç’°å¢ƒè®Šæ•¸ç¯„æœ¬

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### é æ¸¬æ¨¡å‹
- **LSTM** - é æ¸¬ä¸‹ä¸€äº¤æ˜“æ—¥æ”¶ç›¤åƒ¹ â­ ä¸»è¦æ¨¡å‹ï¼ˆæ–¹å‘æº–ç¢ºåº¦ 54.6%ï¼‰
- **ç„éµé‡åŠç­–ç•¥** - å‡ç·šæŠ€è¡“åˆ†æ ğŸ†• åŸºæ–¼ MA5/MA60/MA120/MA250

### é›™è»Œç­–ç•¥ç³»çµ± ğŸ†•
çµåˆæ·±åº¦å­¸ç¿’èˆ‡æŠ€è¡“é¢åˆ†æçš„é›™é‡é©—è­‰æ©Ÿåˆ¶ï¼š
- **LSTM é æ¸¬** - AI é æ¸¬æ˜æ—¥è‚¡åƒ¹ï¼Œè‡ªå‹•è¨ˆç®—æ¼²å¹…æ½›åŠ›
- **ç„éµé‡åŠ** - MA å‡ç·šç­–ç•¥ï¼Œç¯©é¸ç¬¦åˆæŠ€è¡“é¢æ¢ä»¶çš„è‚¡ç¥¨
- **é›™é‡ç¬¦åˆ** - åŒæ™‚é€šéå…©ç¨®ç­–ç•¥çš„é«˜ä¿¡å¿ƒæ¨™çš„
- **åŸºæœ¬é¢æ•´åˆ** - è‡ªå‹•æŠ“å– PE/PB/Forward PE æ•¸æ“š

### é—œéµç‰¹æ€§
- âœ… **ä¸‹ä¸€æ—¥é æ¸¬** - é æ¸¬æ˜å¤©çš„è‚¡åƒ¹ï¼Œå¯¦ç”¨æ€§é«˜
- âœ… **è‡ªå‹•å›æ¸¬** - æ¯æ—¥é©—è­‰é æ¸¬æº–ç¢ºåº¦
- âœ… **å¤šå¸‚å ´æ”¯æŒ** - å°è‚¡ã€ç¾è‚¡
- âœ… **ä¸¦è¡Œè™•ç†** - 8 å€‹ workers åŒæ™‚è™•ç† LSTM
- âœ… **æŠ€è¡“é¢ç¯©é¸** - MA5/MA10/MA60/MA120/MA250 å‡ç·šç­–ç•¥ ğŸ†•
- âœ… **åŸºæœ¬é¢æ•¸æ“š** - PE/PB/Forward PE è‡ªå‹•ç²å– ğŸ†•
- âœ… **Supabase æ•´åˆ** - é›²ç«¯è³‡æ–™åº«å„²å­˜ï¼ˆå«é›™è»Œç­–ç•¥è¡¨ï¼‰ğŸ†•
- âœ… **å¤šé€šçŸ¥ç®¡é“** - Discordã€Telegramã€Email

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å®‰è£

```bash
git clone https://github.com/tbdavid2019/stock-underdog-ml.git
cd stock-underdog-ml
python3.11 -m venv myenv
source myenv/bin/activate
pip install -r requirements.txt
```

### 2. è¨­å®š

```bash
cp .env.example .env
# ç·¨è¼¯ .env å¡«å…¥ Supabase credentials
```

**é—œéµè¨­å®šï¼š**
```bash
# å¿…å¡«
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_KEY=your_service_role_key

# æ¨¡å‹é¸æ“‡ï¼ˆå»ºè­°åªé–‹ LSTMï¼‰
USE_PROPHET=false
USE_CHRONOS=false
USE_CROSS=false
USE_TRANSFORMER=false
```

### 3. å»ºç«‹è³‡æ–™åº«

åœ¨ [Supabase Dashboard](https://app.supabase.com) åŸ·è¡Œ `supabase_schema.sql`

**æ–°ç”¨æˆ¶**ï¼šç›´æ¥åŸ·è¡Œï¼Œå·²åŒ…å«æ‰€æœ‰é›™è»Œç­–ç•¥æ¬„ä½
**èˆŠç”¨æˆ¶å‡ç´š**ï¼šåŸ·è¡Œ `scripts/migration/supabase_add_columns.sql` æ·»åŠ æ–°æ¬„ä½

è¡¨æ ¼çµæ§‹ï¼š
```sql
-- predictions è¡¨æ ¼ï¼ˆå·²åŒ…å«é›™è»Œç­–ç•¥æ¬„ä½ï¼‰
-- åŸºæœ¬æ¬„ä½ï¼šticker, current_price, predicted_price, potential
-- ç­–ç•¥æ¬„ä½ï¼šstrategy_type, model_name
-- æŠ€è¡“é¢ï¼šma5, ma10, ma60, ma120, ma250, pullback_type
-- åŸºæœ¬é¢ï¼špe, pb, forward_pe
-- å›æ¸¬æ¬„ä½ï¼šactual_price, accuracy, percentage_error
```

### 4. åŸ·è¡Œ

**ä¸»ç¨‹å¼ï¼ˆé›™è»Œç­–ç•¥ï¼‰ï¼š**
```bash
python main.py
```

**èˆŠç‰ˆï¼ˆç´” LSTMï¼‰ï¼š**
```bash
python main_lstm_only.py
```

è©³ç´°æ­¥é©Ÿè«‹åƒè€ƒ **[SETUP.md](SETUP.md)**

---

## ğŸ“Š é æ¸¬é‚è¼¯

### LSTM æ™‚é–“è»¸

```
ä»Šå¤© 1/8              æ˜å¤© 1/9              å¾Œå¤© 1/10
   â”‚                    â”‚                    â”‚
   â–¼                    â–¼                    â–¼
åŸ·è¡Œ main.py      â† é æ¸¬é€™å¤©çš„åƒ¹æ ¼    åŸ·è¡Œ backtest.py
ä¸‹è¼‰ 6 å€‹æœˆè³‡æ–™                        é©—è­‰é æ¸¬æº–ç¢ºåº¦
è¨“ç·´ LSTM æ¨¡å‹
é æ¸¬æ˜å¤©æ”¶ç›¤åƒ¹
å„²å­˜åˆ°è³‡æ–™åº«
```

### ç„éµé‡åŠç­–ç•¥ ğŸ†•

åŸºæ–¼ã€Šç¬‘å‚²æ±Ÿæ¹–ã€‹ä¸­ã€Œé‡åŠç„¡é‹’ï¼Œå¤§å·§ä¸å·¥ã€çš„ç†å¿µï¼Œä½¿ç”¨å‡ç·šåˆ¤æ–·å¤§å‹¢ï¼š

**Filter 1 - å¤§å‹¢å‘ä¸Šï¼ˆMA60 ä¸Šå‡è¶¨å‹¢ï¼‰ï¼š**
- MA60 åœ¨éå» 10 å€‹äº¤æ˜“æ—¥å‘ˆç¾ä¸Šå‡
- è‚¡åƒ¹ä½æ–¼ MA60 ä¹‹ä¸Š

**Filter 2 - å°å‹¢å›èª¿ï¼ˆè²·å…¥æ™‚æ©Ÿï¼‰ï¼š**
- åƒ¹æ ¼æ¥è¿‘æˆ–çŸ­æš«è·Œç ´ MA60 (Â±5% å®¹å¿)
- æˆ–æ¥è¿‘ MA120 (Â±5% å®¹å¿)

**å›èª¿é¡å‹åˆ¤è®€ï¼š**

| å›èª¿é¡å‹ | å«ç¾© | è²·é»å¼·åº¦ | èªªæ˜ |
|---------|------|---------|------|
| **MA60å›èª¿** | åƒ¹æ ¼åœ¨ MA60 é™„è¿‘ Â±5% | â­â­â­ è¼ƒæ¿€é€² | å‰›å¾ä¸­æœŸå‡ç·šåå½ˆï¼Œé©åˆç©æ¥µå‹æŠ•è³‡è€… |
| **MA120å›èª¿** | åƒ¹æ ¼åœ¨ MA120 é™„è¿‘ Â±5% | â­â­â­â­ è¼ƒç©©å¥ | åƒ¹æ ¼å›åˆ°æ›´å¼·æ”¯æ’ä½ï¼Œé¢¨éšªç›¸å°è¼ƒä½ |

**æŠ€è¡“æŒ‡æ¨™è¨ˆç®—ï¼š**
- MA5ï¼š5 æ—¥å‡ç·šï¼ˆçŸ­æœŸè¶¨å‹¢ï¼‰
- MA10ï¼š10 æ—¥å‡ç·šï¼ˆçŸ­æœŸè¶¨å‹¢ç¢ºèªï¼‰
- MA60ï¼š60 æ—¥å‡ç·šï¼ˆä¸­æœŸè¶¨å‹¢ï¼Œå¤§å‹¢åˆ¤æ–·æ ¸å¿ƒï¼‰
- MA120ï¼š120 æ—¥å‡ç·šï¼ˆä¸­æœŸæ”¯æ’ï¼‰
- MA250ï¼š250 æ—¥å‡ç·šï¼ˆé•·æœŸåƒ¹å€¼ä¸­æ¨ï¼‰

**åƒæ•¸è¨­å®šï¼š**
```python
lookback = 10      # MA60 æ–œç‡æª¢æŸ¥å¤©æ•¸
tolerance = 0.05   # Â±5% å›èª¿å®¹å¿ç¯„åœ
```

**é æœŸé€šéç‡ï¼š** ç´„ 15-20%ï¼ˆåš´æ ¼ç¯©é¸ï¼‰

### é›™è»Œç­–ç•¥æ•´åˆ ğŸ†•

åŒæ™‚åŸ·è¡Œå…©ç¨®åˆ†ææ–¹æ³•ï¼Œè¼¸å‡ºä¸‰ç¨®çµæœï¼š

1. **ç„éµé‡åŠ** - åƒ…é€šé MA å‡ç·šç¯©é¸
2. **LSTMé æ¸¬** - åƒ… AI é æ¸¬æœ‰æ½›åŠ›
3. **é›™é‡ç¬¦åˆ** - åŒæ™‚ç¬¦åˆå…©ç¨®ç­–ç•¥ï¼ˆæœ€é«˜ä¿¡å¿ƒï¼‰

### é æ¸¬å…§å®¹

- **è¼¸å…¥**ï¼šéå» 90 å€‹äº¤æ˜“æ—¥çš„ OHLCV è³‡æ–™
- **è¼¸å‡º**ï¼šä¸‹ä¸€å€‹äº¤æ˜“æ—¥çš„æ”¶ç›¤åƒ¹
- **æ½›åŠ›è¨ˆç®—**ï¼š`(é æ¸¬åƒ¹ - ç•¶å‰åƒ¹) / ç•¶å‰åƒ¹ Ã— 100%`
- **åŸºæœ¬é¢æ•¸æ“š** ğŸ†•ï¼šPE (æœ¬ç›Šæ¯”), PB (è‚¡åƒ¹æ·¨å€¼æ¯”), Forward PE (é ä¼°æœ¬ç›Šæ¯”)

### å›æ¸¬é©—è­‰

- **é »ç‡**ï¼šæ¯æ—¥åŸ·è¡Œï¼ˆå»ºè­°ç”¨ cronï¼‰
- **æ–¹æ³•**ï¼šæ¯”å°é æ¸¬åƒ¹ vs å¯¦éš›æ”¶ç›¤åƒ¹
- **æŒ‡æ¨™**ï¼šæ–¹å‘æº–ç¢ºåº¦ã€å¹³å‡èª¤å·®ã€èª¤å·®åˆ†å¸ƒ

è©³ç´°èªªæ˜è«‹åƒè€ƒ **[backtest/README.md](backtest/README.md)**

---

## ğŸ¯ é›™è»Œç­–ç•¥è©³è§£ ğŸ†•

### è¨­è¨ˆç†å¿µ

**ç‚ºä½•éœ€è¦é›™è»Œç­–ç•¥ï¼Ÿ**
- LSTM å–„æ–¼æ•æ‰åƒ¹æ ¼è®ŠåŒ–æ¨¡å¼ï¼Œä½†å¯èƒ½å¿½ç•¥æŠ€è¡“é¢è¨Šè™Ÿ
- å‡ç·šç­–ç•¥åŸºæ–¼æˆç†Ÿçš„æŠ€è¡“åˆ†æï¼Œä½†ç¼ºä¹ AI çš„é æ¸¬èƒ½åŠ›
- çµåˆå…©è€…å¯æä¾›**é›™é‡é©—è­‰**ï¼Œé™ä½èª¤åˆ¤é¢¨éšª

### åŸ·è¡Œæµç¨‹

```
1. ä¸‹è¼‰è‚¡ç¥¨åˆ—è¡¨ (å°ç£50/SP500...)
            â”‚
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼                     â–¼                     â–¼
    2a. LSTM é æ¸¬          2b. ç„éµç¯©é¸          3. è¨ˆç®—é‡ç–Š
    (ä¸¦è¡Œ 8 workers)       (MA å‡ç·šæª¢æŸ¥)
    - è¨“ç·´æ¨¡å‹               - MA60 ä¸Šå‡è¶¨å‹¢
    - é æ¸¬æ˜æ—¥åƒ¹             - MA60/MA120 å›èª¿
    - è¨ˆç®—æ½›åŠ› %             - ç²å– MA5/MA10/MA250
    - æŠ“å– PE/PB             - æŠ“å– PE/PB
            â”‚                     â”‚                     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â–¼
            4. ä¸‰ç¨®è¼¸å‡ºçµæœ
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ ğŸ¯ ç„éµé‡åŠ (æŠ€è¡“é¢ç¬¦åˆ)           â”‚
            â”‚ ğŸ§  LSTMé æ¸¬ (AI çœ‹å¥½)              â”‚
            â”‚ â­ é›™é‡ç¬¦åˆ (å…©è€…çš†ç¬¦åˆï¼Œæœ€é«˜ä¿¡å¿ƒ) â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â–¼
            5. ä¿å­˜åˆ° Supabase + ç™¼é€é€šçŸ¥
```

### ç­–ç•¥åƒæ•¸

**ç„éµé‡åŠç­–ç•¥ï¼š**
```python
lookback = 10      # MA60 ä¸Šå‡è¶¨å‹¢æª¢æŸ¥å¤©æ•¸
tolerance = 0.05   # Â±5% å›èª¿å®¹å¿ç¯„åœ
period = "1y"      # ä½¿ç”¨ 1 å¹´æ•¸æ“šè¨ˆç®—å‡ç·š
```

**LSTM ç­–ç•¥ï¼š**
```python
sequence_length = 90  # ä½¿ç”¨ 90 å¤©æ•¸æ“šè¨“ç·´
epochs = 20           # è¨“ç·´è¼ªæ•¸
period = "6mo"        # ä½¿ç”¨ 6 å€‹æœˆæ•¸æ“š
```

### è¼¸å‡ºæ ¼å¼

åŸ·è¡Œ `python main.py` å¾Œæœƒçœ‹åˆ°ï¼š

```
========================================
ğŸ“Š å°ç£50 é›™è»Œç­–ç•¥å ±å‘Š
========================================

ğŸ¯ ç„éµé‡åŠç­–ç•¥ (3 æª”)
è‚¡ç¥¨       ç¾åƒ¹      MA60      MA120     å›èª¿é¡å‹    PE    PB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2330.TW    1670.00   1650.00   1600.00   MA60å›èª¿   24.5  8.2
2317.TW     234.50    230.00    225.00   MA60å›èª¿   18.3  3.1
2454.TW    1234.50   1220.00   1200.00   MA120å›èª¿  15.8  2.9

ğŸ§  LSTM é æ¸¬ç­–ç•¥ (8 æª”)
è‚¡ç¥¨       ç¾åƒ¹      é æ¸¬åƒ¹     æ½›åŠ›      PE    Forward PE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2454.TW    1234.50   1280.00   3.68%    15.2    14.8
2412.TW     456.00    478.00   4.82%    22.1    20.5
...

â­ é›™é‡ç¬¦åˆ (2 æª”) â† æœ€é«˜ä¿¡å¿ƒ
è‚¡ç¥¨       ç¾åƒ¹      é æ¸¬åƒ¹    æ½›åŠ›     MA60      PE    PB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2330.TW    1670.00   1720.00   3.00%   1650.00  24.5  8.2
2454.TW    1234.50   1280.00   3.68%   1220.00  15.8  2.9

åŸ·è¡Œæ™‚é–“: 45.2 ç§’
```

### å¦‚ä½•è§£è®€

1. **åªçœ‹é›™é‡ç¬¦åˆ**ï¼šä¿å®ˆå‹æŠ•è³‡è€…ï¼Œåªé—œæ³¨åŒæ™‚é€šéå…©ç¨®ç­–ç•¥çš„è‚¡ç¥¨
2. **ç„éµ + LSTM**ï¼šåƒè€ƒå…©è€…äº¤é›†ï¼Œæ‰‹å‹•ç¯©é¸
3. **å–®çœ‹ç„éµ**ï¼šåå¥½æŠ€è¡“é¢åˆ†æ
4. **å–®çœ‹ LSTM**ï¼šä¿¡ä»» AI é æ¸¬

### é…ç½®é€šçŸ¥

åœ¨ `.env` ä¸­è¨­å®šï¼š
```bash
# Telegram
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id

# Discord
DISCORD_WEBHOOK_URL=your_webhook_url

# Email (SMTP)
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_EMAIL=your_email@gmail.com
SMTP_PASSWORD=your_app_password
EMAIL_TO=recipient@example.com
```

### Supabase è¨­å®š

1. é€²å…¥ [Supabase Dashboard](https://app.supabase.com)
2. é¸æ“‡å°ˆæ¡ˆ â†’ SQL Editor
3. åŸ·è¡Œ `supabase_dual_strategy_schema.sql`
4. ç¢ºèªè¡¨æ ¼å»ºç«‹ï¼š`dual_strategy_predictions`

è¡¨æ ¼æ¬„ä½ï¼š
```sql
- index_name          æŒ‡æ•¸åç¨±
- strategy_type       ç­–ç•¥é¡å‹ (ç„éµé‡åŠ/LSTMé æ¸¬/é›™é‡ç¬¦åˆ)
- ticker              è‚¡ç¥¨ä»£ç¢¼
- current_price       ç•¶å‰åƒ¹æ ¼
- predicted_price     LSTM é æ¸¬åƒ¹æ ¼
- potential           é æ¸¬æ¼²å¹… %
- ma5, ma10, ma60,    å„å‡ç·šå€¼
  ma120, ma250
- pullback_type       å›èª¿é¡å‹ (MA60å›èª¿/MA120å›èª¿)
- pe, pb, forward_pe  åŸºæœ¬é¢æ•¸æ“š
- period              æ•¸æ“šé€±æœŸ
- timestamp           åˆ†ææ™‚é–“
```

---

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
stock-underdog-ml/
â”œâ”€â”€ README.md              â† ä½ åœ¨é€™è£¡
â”œâ”€â”€ SETUP.md              â† å®‰è£æŒ‡å—
â”œâ”€â”€ .env.example          â† ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
â”‚
â”œâ”€â”€ main.py               â† ä¸»ç¨‹å¼ï¼ˆé›™è»Œç­–ç•¥ï¼‰ğŸ†•
â”œâ”€â”€ main_lstm_only.py     â† å–®ä¸€ LSTM æ¨¡å‹ï¼ˆèˆŠç‰ˆä¿ç•™ï¼‰
â”‚
â”œâ”€â”€ config.py             â† è¨­å®šç®¡ç†
â”œâ”€â”€ database.py           â† Supabase æ•´åˆï¼ˆå¯«å…¥ predictions è¡¨æ ¼ï¼‰ğŸ†•
â”œâ”€â”€ parallel_processor.py â† ä¸¦è¡Œè™•ç†
â”œâ”€â”€ data_loader.py        â† æ•¸æ“šä¸‹è¼‰ï¼ˆå« 12hr å¿«å–ï¼‰ğŸ†•
â”‚
â”œâ”€â”€ xuantie_strategy.py   â† ç„éµé‡åŠå‡ç·šç­–ç•¥ ğŸ†•
â”œâ”€â”€ notifier_dual.py      â† é›™è»Œç­–ç•¥é€šçŸ¥å™¨ ğŸ†•
â”‚
â”œâ”€â”€ models/               â† é æ¸¬æ¨¡å‹
â”‚   â””â”€â”€ lstm.py          â† LSTM ä¸‹ä¸€æ—¥é æ¸¬
â”‚
â”œâ”€â”€ cache/               â† è³‡æ–™å¿«å– ğŸ†•
â”‚   â””â”€â”€ stock_data/      â† è‚¡ç¥¨æ•¸æ“š pickle å¿«å–ï¼ˆ12å°æ™‚ï¼‰
â”‚
â”œâ”€â”€ output/              â† è¼¸å‡ºæ–‡ä»¶ ğŸ†•
â”‚   â””â”€â”€ xuantie_signals_*.csv  â† ç„éµç­–ç•¥ç¯©é¸çµæœ
â”‚
â”œâ”€â”€ backtest/            â† å›æ¸¬ç³»çµ±
â”‚   â”œâ”€â”€ README.md        â† å›æ¸¬èªªæ˜
â”‚   â”œâ”€â”€ backtest.py      â† å›æ¸¬è…³æœ¬
â”‚   â””â”€â”€ run_backtest.sh  â† è‡ªå‹•åŒ–è…³æœ¬
â”‚
â”œâ”€â”€ scripts/             â† æ¸¬è©¦å’Œç¶­è­·è…³æœ¬
â”‚   â”œâ”€â”€ migration/       â† æ•¸æ“šåº«é·ç§»è…³æœ¬ï¼ˆèˆŠç‰ˆå‡ç´šç”¨ï¼‰ğŸ†•
â”‚   â”œâ”€â”€ verification/    â† é©—è­‰è…³æœ¬ ğŸ†•
â”‚   â”œâ”€â”€ README.md
â”‚   â””â”€â”€ [å…¶ä»–æ¸¬è©¦è…³æœ¬...]
â”‚
â”œâ”€â”€ supabase_schema.sql  â† å®Œæ•´è³‡æ–™åº«çµæ§‹ï¼ˆå·²åŒ…å«é›™è»Œç­–ç•¥æ¬„ä½ï¼‰ğŸ†•
â”‚
â””â”€â”€ logs/                â† åŸ·è¡Œæ—¥èªŒ
```

---

## ğŸ“‹ æª”æ¡ˆèªªæ˜

### ä¸»ç¨‹å¼
- **main.py** - é›™è»Œç­–ç•¥ä¸»ç¨‹å¼ï¼ˆLSTM + ç„éµé‡åŠï¼‰
- **main_lstm_only.py** - ç´” LSTM ç‰ˆæœ¬ï¼ˆå‘å¾Œå…¼å®¹ï¼‰

### ç­–ç•¥æ¨¡çµ„
- **xuantie_strategy.py** - MA å‡ç·šç­–ç•¥ï¼ˆMA5/MA10/MA60/MA120/MA250ï¼‰
- **notifier_dual.py** - å¤šå¹³å°é€šçŸ¥ï¼ˆTelegram/Discord/Emailï¼‰

### è³‡æ–™åº«
- **supabase_schema.sql** - å®Œæ•´è³‡æ–™åº«çµæ§‹
  - åŒ…å«ï¼špredictions è¡¨æ ¼ï¼ˆå·²æ“´å±•ï¼‰
  - æ¬„ä½ï¼šstrategy_type, ma5-ma250, pe/pb/forward_pe
  - ç´¢å¼•ï¼šé‡å°é›™è»Œç­–ç•¥æŸ¥è©¢å„ªåŒ–
- **database.py** - Python è³‡æ–™åº«æ“ä½œ
  - å¯«å…¥ predictions è¡¨æ ¼
  - æ”¯æ´ä¸‰ç¨®ç­–ç•¥é¡å‹ï¼ˆç„éµé‡åŠ/LSTMé æ¸¬/é›™é‡ç¬¦åˆï¼‰

### é·ç§»è…³æœ¬ï¼ˆèˆŠç‰ˆç”¨æˆ¶å‡ç´šï¼‰
- **scripts/migration/supabase_add_columns.sql** - ç‚ºç¾æœ‰è¡¨æ ¼æ·»åŠ æ–°æ¬„ä½
- **scripts/verification/verify_predictions_extended.py** - é©—è­‰è¡¨æ ¼çµæ§‹

---

## âš™ï¸ è¨­å®šé¸é …

### æ¨¡å‹é–‹é—œï¼ˆ.envï¼‰

```bash
# å»ºè­°é…ç½®ï¼šåªä½¿ç”¨ LSTM
USE_PROPHET=false
USE_CHRONOS=false
USE_CROSS=false
USE_TRANSFORMER=false
```

### é¸æ“‡è‚¡ç¥¨æŒ‡æ•¸ï¼ˆmain.pyï¼‰

```python
selected_indices = ["å°ç£50", "å°ç£ä¸­å‹100", "SP500"]
```

å¯ç”¨æŒ‡æ•¸ï¼š
- `å°ç£50` - å°ç£å¸‚å€¼å‰ 50
- `å°ç£ä¸­å‹100` - å°ç£ä¸­å‹è‚¡
- `SP500` - æ¨™æ™® 500
- `NASDAQ` - é‚£æ–¯é”å…‹ 100
- `è²»åŸåŠå°é«”` - SOX æŒ‡æ•¸
- `é“ç“Š` - é“ç“Šå·¥æ¥­

---

## ğŸ“ˆ æ¨¡å‹è¡¨ç¾

åŸºæ–¼ 543 ç­†å›æ¸¬è³‡æ–™ï¼ˆ2026-01-05 ~ 2026-01-08ï¼‰ï¼š

### LSTM
- **æ–¹å‘æº–ç¢ºåº¦ï¼š54.6%** âš ï¸ï¼ˆç•¥é«˜æ–¼éš¨æ©Ÿ 50%ï¼‰
- **å¹³å‡èª¤å·®ï¼š21.3%**
- **èª¤å·® â‰¤10%ï¼š53.3%**
- **èª¤å·® â‰¤20%ï¼š71.2%**

### å„æŒ‡æ•¸è¡¨ç¾
- **å°ç£ä¸­å‹100ï¼š51.9%** - æœ€ä½³
- **SP500ï¼š48.5%**
- **å°ç£50ï¼š41.5%** - éœ€æ”¹é€²

**çµè«–ï¼š** æ¨¡å‹æœ‰æ”¹é€²ç©ºé–“ï¼Œä½†é‚è¼¯æ­£ç¢ºï¼Œå¯ç”¨æ–¼å¯¦éš›äº¤æ˜“åƒè€ƒã€‚

---

## ğŸ“ˆ è¼¸å‡ºçµæœ

### è³‡æ–™åº«ï¼ˆSupabaseï¼‰

**å–®ä¸€ LSTM æ¨¡å‹ï¼š**
```sql
SELECT ticker, predicted_price, potential 
FROM predictions 
WHERE timestamp > NOW() - interval '1 day'
ORDER BY potential DESC
LIMIT 10;
```

**é›™è»Œç­–ç•¥** ğŸ†•ï¼š
```sql
-- æŸ¥è©¢é›™é‡ç¬¦åˆï¼ˆæœ€é«˜ä¿¡å¿ƒï¼‰
SELECT ticker, strategy_type, current_price, predicted_price, potential,
       ma5, ma60, ma120, ma250, pullback_type, pe, pb
FROM dual_strategy_predictions 
WHERE strategy_type = 'é›™é‡ç¬¦åˆ'
  AND timestamp > NOW() - interval '1 day'
ORDER BY potential DESC;

-- æŸ¥è©¢å„ç­–ç•¥çµ±è¨ˆ
SELECT strategy_type, COUNT(*) as count
FROM dual_strategy_predictions
WHERE timestamp > NOW() - interval '1 day'
GROUP BY strategy_type;
```

### é€šçŸ¥ï¼ˆDiscord/Telegramï¼‰

**å–®ä¸€æ¨¡å‹ï¼š**
```
ğŸ¥‡ å‰äº”å LSTM ğŸ§ 
è‚¡ç¥¨     ç¾åƒ¹      é æ¸¬åƒ¹     æ½›åŠ›
----------------------------------------
2330.TW  1670.00   1720.00    3.00%
2317.TW   234.50    245.00    4.48%
...
```

**é›™è»Œç­–ç•¥** ğŸ†•ï¼š
```
========================================
ğŸ“Š å°ç£50 é›™è»Œç­–ç•¥å ±å‘Š
========================================

ğŸ¯ ç„éµé‡åŠç­–ç•¥ (MAå‡ç·šç¯©é¸)
è‚¡ç¥¨      ç¾åƒ¹      MA60      å›èª¿é¡å‹    PE    PB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2330.TW   1670.00   1650.00   MA60å›èª¿   24.5  8.2
2317.TW    234.50    230.00   MA60å›èª¿   18.3  3.1

ğŸ§  LSTM é æ¸¬ç­–ç•¥
è‚¡ç¥¨      ç¾åƒ¹      é æ¸¬åƒ¹     æ½›åŠ›      PE    Forward PE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2454.TW   1234.50   1280.00   3.68%    15.2    14.8
2412.TW    456.00    478.00   4.82%    22.1    20.5

â­ é›™é‡ç¬¦åˆ (é«˜ä¿¡å¿ƒ)
è‚¡ç¥¨      ç¾åƒ¹      é æ¸¬åƒ¹    æ½›åŠ›     MA60      PE    PB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2330.TW   1670.00   1720.00   3.00%   1650.00  24.5  8.2

åŸ·è¡Œæ™‚é–“: 45.2 ç§’
```

---

## ğŸ”„ è‡ªå‹•åŒ–åŸ·è¡Œ

### Cron è¨­å®š

**å–®ä¸€ LSTM æ¨¡å‹ï¼š**
```bash
crontab -e

# æ¯å¤©æ—©ä¸Š 8 é»åŸ·è¡Œé æ¸¬
0 8 * * * /home/ec2-user/stock-underdog-ml/run.sh

# æ¯å¤©æ—©ä¸Š 9 é»åŸ·è¡Œå›æ¸¬ï¼ˆç´„ 3 åˆ†é˜ï¼‰
0 9 * * * /home/ec2-user/stock-underdog-ml/backtest/run_backtest.sh
```

**é›™è»Œç­–ç•¥** ğŸ†•ï¼š
```bash
crontab -e

# æ¯å¤©å°è‚¡æ”¶ç›¤å¾Œ 15:00 åŸ·è¡Œé›™è»Œåˆ†æ
0 15 * * 1-5 cd /home/ec2-user/stock-underdog-ml && source myenv/bin/activate && python main_dual_strategy.py >> logs/dual_strategy.log 2>&1

# æˆ–ä½¿ç”¨ bash è…³æœ¬
0 15 * * 1-5 /home/ec2-user/stock-underdog-ml/run_dual.sh
```

**run_dual.sh ç¯„ä¾‹ï¼š**
```bash
#!/bin/bash
cd /home/ec2-user/stock-underdog-ml
source myenv/bin/activate
python main_dual_strategy.py
deactivate
```

---

## ğŸ§ª å›æ¸¬ç³»çµ±

é©—è­‰æ¨¡å‹é æ¸¬æº–ç¢ºåº¦çš„å®Œæ•´ç³»çµ±ã€‚

### é—œéµæŒ‡æ¨™

- **æ–¹å‘æº–ç¢ºåº¦** - é æ¸¬æ¼²è·Œæ–¹å‘çš„æ­£ç¢ºç‡ï¼ˆç›®æ¨™ >60%ï¼‰
- **å¹³å‡èª¤å·®** - é æ¸¬åƒ¹æ ¼çš„å¹³å‡èª¤å·®ç™¾åˆ†æ¯”
- **èª¤å·® â‰¤5%** - é«˜ç²¾åº¦é æ¸¬çš„æ¯”ä¾‹

### åŸ·è¡Œå›æ¸¬

```bash
python backtest/backtest.py
python backtest/analyze_backtest.py
```

è©³ç´°èªªæ˜è«‹åƒè€ƒ **[backtest/README.md](backtest/README.md)**

---

## ğŸ› ï¸ ç–‘é›£æ’è§£

### Keras ç‰ˆæœ¬å•é¡Œ
```bash
pip install tf-keras
```

### Supabase é€£ç·šå¤±æ•—
1. ç¢ºèªä½¿ç”¨ **service_role** keyï¼ˆä¸æ˜¯ anon keyï¼‰
2. æª¢æŸ¥ `SUPABASE_URL` æ ¼å¼æ­£ç¢º
3. ç¢ºèªè³‡æ–™è¡¨å·²å»ºç«‹
   - å–®ä¸€æ¨¡å‹ï¼šåŸ·è¡Œ `supabase_schema.sql`
   - é›™è»Œç­–ç•¥ï¼šåŸ·è¡Œ `supabase_dual_strategy_schema.sql` ğŸ†•

### è¨˜æ†¶é«”ä¸è¶³
ç·¨è¼¯ `main_dual_strategy.py` é™ä½ä¸¦è¡Œæ•¸ï¼š
```python
max_workers=4  # å¾ 8 é™åˆ° 4
```

### ç„éµç­–ç•¥é€šéç‡ 0% ğŸ†•
å¯èƒ½åŸå› ï¼š
- å¸‚å ´è™•æ–¼ä¸‹è·Œè¶¨å‹¢ï¼ˆMA60 æœªä¸Šå‡ï¼‰
- åƒæ•¸å¤ªåš´æ ¼

èª¿æ•´åƒæ•¸ï¼š
```python
# åœ¨ main_dual_strategy.py ä¸­
xuantie_stocks = filter_stocks_by_xuantie(
    stock_list,
    period="1y",
    lookback=7,      # é™ä½è‡³ 7 å¤©
    tolerance=0.08   # æ”¾å¯¬è‡³ Â±8%
)
```

### æ•¸æ“šå¿«å–å•é¡Œ ğŸ†•
å¿«å–ä½ç½®ï¼š`cache/stock_data/`
å¿«å–æœ‰æ•ˆæœŸï¼š12 å°æ™‚

æ¸…é™¤å¿«å–ï¼š
```bash
rm -rf cache/stock_data/*
```

æ›´å¤šå•é¡Œè«‹åƒè€ƒ **[SETUP.md](SETUP.md)** çš„ç–‘é›£æ’è§£ç« ç¯€

---

## ğŸ“ æ›´æ–°æ—¥èªŒ

### v2.1 (2025-01-22) ğŸ†•
- âœ¨ **æ–°å¢é›™è»Œç­–ç•¥ç³»çµ±**ï¼šçµåˆ LSTM + ç„éµé‡åŠ MA å‡ç·šç­–ç•¥
- âœ¨ **ç„éµé‡åŠç­–ç•¥**ï¼šåŸºæ–¼ MA5/MA10/MA60/MA120/MA250 çš„æŠ€è¡“é¢ç¯©é¸
  - Filter 1ï¼šMA60 ä¸Šå‡è¶¨å‹¢ï¼ˆ10 å¤©ï¼‰+ è‚¡åƒ¹åœ¨ MA60 ä¹‹ä¸Š
  - Filter 2ï¼šåƒ¹æ ¼å›èª¿è‡³ MA60/MA120 (Â±5%)
  - é€šéç‡ï¼šç´„ 15-20%
- âœ¨ **åŸºæœ¬é¢æ•´åˆ**ï¼šè‡ªå‹•æŠ“å– PE/PB/Forward PE æ•¸æ“š
- âœ¨ **æ•¸æ“šå¿«å–ç³»çµ±**ï¼š12 å°æ™‚ pickle å¿«å–ï¼ŒåŠ é€Ÿé‡è¤‡æŸ¥è©¢
- âœ¨ **é›™è»Œç­–ç•¥è³‡æ–™è¡¨**ï¼šåŒ…å« ma5, ma10, ma60, ma120, ma250, pe, pb, forward_pe æ¬„ä½
- âœ¨ **å¤šå¹³å°é€šçŸ¥**ï¼šTelegram (HTML)ã€Discord (Markdown)ã€Email
- ğŸ”§ å„ªåŒ– LSTM ä¸¦è¡Œè™•ç†ï¼š8 workers åŒæ™‚é‹è¡Œ
- ğŸ“Š æ–°å¢ `main_dual_strategy.py` é›™è»Œç­–ç•¥å…¥å£
- ğŸ“Š æ–°å¢ `xuantie_strategy.py` å‡ç·šç­–ç•¥æ¨¡çµ„
- ğŸ“Š æ–°å¢ `notifier_dual.py` é›™è»Œé€šçŸ¥å™¨
- ğŸ“Š æ–°å¢ `data_loader.py` å¿«å–ç³»çµ±

### v2.0 (2026-01-08)
- âœ¨ **é‡å¤§æ”¹é€²**ï¼šæ”¹ç‚ºé æ¸¬ä¸‹ä¸€äº¤æ˜“æ—¥ï¼ˆåŸç‚ºæ­·å²æœ€å¤§å€¼ï¼‰
- âœ¨ æ–°å¢è‡ªå‹•å›æ¸¬ç³»çµ±
- âœ¨ å„ªåŒ– LSTM æ¶æ§‹ï¼ˆ3 å±¤ï¼Œ128â†’64â†’32 unitsï¼‰
- âœ¨ å¢åŠ è¨“ç·´ epochsï¼ˆ10â†’100ï¼Œå¾Œå„ªåŒ–ç‚º 20ï¼‰
- ğŸ› ä¿®å¾©è³‡æ–™æ´©æ¼å•é¡Œ
- ğŸ”§ é—œé–‰ Prophet å’Œ Chronosï¼ˆæº–ç¢ºåº¦ä¸ä½³ï¼‰
- ğŸ“ æ•´ç†å°ˆæ¡ˆçµæ§‹ï¼ˆæ–°å¢ scripts/ è³‡æ–™å¤¾ï¼‰

### v1.0
- åˆå§‹ç‰ˆæœ¬

---

## ï¿½ï¸ æª”æ¡ˆçµæ§‹æ•´ç†

### ç›®éŒ„åˆ†é¡

**æ ¹ç›®éŒ„** - ä¸»ç¨‹å¼å’Œæ ¸å¿ƒæ¨¡çµ„
- `main.py` - ä¸»ç¨‹å¼ï¼ˆé›™è»Œç­–ç•¥ï¼‰
- `main_lstm_only.py` - èˆŠç‰ˆä¿ç•™

**cache/** - æ•¸æ“šå¿«å–ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
- `stock_data/` - è‚¡ç¥¨æ•¸æ“š pickle å¿«å–ï¼ˆ12å°æ™‚ï¼‰

**output/** - è¼¸å‡ºæ–‡ä»¶ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
- `xuantie_signals_*.csv` - ç„éµç­–ç•¥ç¯©é¸çµæœ

**logs/** - åŸ·è¡Œæ—¥èªŒï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
- `app.log` - ä¸»ç¨‹å¼æ—¥èªŒ

**scripts/** - ç¶­è­·å’Œæ¸¬è©¦è…³æœ¬
- `migration/` - æ•¸æ“šåº«é·ç§»ï¼ˆèˆŠç‰ˆå‡ç´šç”¨ï¼‰
- `verification/` - è¡¨æ ¼é©—è­‰è…³æœ¬
- å…¶ä»–æ¸¬è©¦è…³æœ¬

**backtest/** - å›æ¸¬ç³»çµ±
- `backtest.py` - å›æ¸¬è…³æœ¬
- `run_backtest.sh` - è‡ªå‹•åŒ–è…³æœ¬

**models/** - AI æ¨¡å‹
- `lstm.py` - LSTM æ¨¡å‹

### æ•¸æ“šåº«æª”æ¡ˆ

**æ–°ç”¨æˆ¶ï¼ˆæ¨è–¦ï¼‰ï¼š**
- `supabase_schema.sql` - åŸ·è¡Œæ­¤æª”æ¡ˆï¼Œå·²åŒ…å«æ‰€æœ‰æ¬„ä½

**èˆŠç”¨æˆ¶å‡ç´šï¼š**
- `scripts/migration/supabase_add_columns.sql` - æ·»åŠ é›™è»Œç­–ç•¥æ¬„ä½
- `scripts/verification/verify_predictions_extended.py` - é©—è­‰è¡¨æ ¼çµæ§‹

### é‡è¦æç¤º

1. **å–®ä¸€è³‡æ–™è¡¨** - æ‰€æœ‰æ•¸æ“šï¼ˆLSTM + ç„éµç­–ç•¥ï¼‰å¯«å…¥åŒä¸€å¼µ `predictions` è¡¨æ ¼
2. **å‘å¾Œå…¼å®¹** - èˆŠæ•¸æ“š `strategy_type = NULL`ï¼Œæ–°æ•¸æ“šæœ‰æ˜ç¢ºç­–ç•¥é¡å‹
3. **å›æ¸¬å…¼å®¹** - å› ç‚ºä½¿ç”¨åŒä¸€å¼µè¡¨ï¼Œå›æ¸¬åŠŸèƒ½å®Œå…¨å…¼å®¹
4. **è‡ªå‹•ç”Ÿæˆ** - `cache/`, `output/`, `logs/` æœƒè‡ªå‹•å‰µå»ºï¼Œä¸éœ€æ‰‹å‹•å»ºç«‹

---
## â° è‡ªå‹•åŒ–èˆ‡æ’ç¨‹

### ç’°å¢ƒèªªæ˜

æœ¬å°ˆæ¡ˆä½¿ç”¨ **conda stockml** ç’°å¢ƒï¼Œè«‹ç¢ºä¿æ’ç¨‹è…³æœ¬æ­£ç¢ºå•Ÿå‹•ç’°å¢ƒã€‚

### å¿«é€Ÿè¨­ç½®æ’ç¨‹

#### æ–¹æ³• 1ï¼šä½¿ç”¨äº’å‹•å¼è¨­ç½®è…³æœ¬ï¼ˆæ¨è–¦ï¼‰

```bash
./setup_cron.sh
```

è…³æœ¬æœƒè©¢å•æ‚¨æƒ³è¦çš„åŸ·è¡Œæ™‚é–“ï¼š
- **é¸é … 1**ï¼šå°è‚¡æ”¶ç›¤å¾Œ 14:30ï¼ˆé€±ä¸€è‡³é€±äº”ï¼‰
- **é¸é … 2**ï¼šç¾è‚¡æ”¶ç›¤å¾Œ 06:30ï¼ˆé€±ä¸€è‡³é€±äº”ï¼‰
- **é¸é … 3**ï¼šæ¯æ—¥åˆå¤œ 00:00
- **é¸é … 4**ï¼šè‡ªè¨‚æ™‚é–“

#### æ–¹æ³• 2ï¼šæ‰‹å‹•è¨­ç½® crontab

```bash
crontab -e
```

æ·»åŠ ä»¥ä¸‹å…¶ä¸­ä¸€è¡Œï¼š

```bash
# å°è‚¡æ”¶ç›¤å¾ŒåŸ·è¡Œï¼ˆé€±ä¸€è‡³é€±äº” 14:30ï¼‰
30 14 * * 1-5 /home/human/stock-underdog-ml/run_daily.sh >> /home/human/stock-underdog-ml/logs/cron.log 2>&1

# ç¾è‚¡æ”¶ç›¤å¾ŒåŸ·è¡Œï¼ˆé€±ä¸€è‡³é€±äº” 6:30ï¼‰
30 6 * * 1-5 /home/human/stock-underdog-ml/run_daily.sh >> /home/human/stock-underdog-ml/logs/cron.log 2>&1

# æ¯æ—¥åˆå¤œåŸ·è¡Œï¼ˆä½¿ç”¨å¿«å–æ•¸æ“šï¼‰
0 0 * * * /home/human/stock-underdog-ml/run_daily.sh >> /home/human/stock-underdog-ml/logs/cron.log 2>&1
```

### åŸ·è¡Œè…³æœ¬èªªæ˜

#### run_daily.shï¼ˆæ¯æ—¥è‡ªå‹•åŸ·è¡Œï¼‰

**åŠŸèƒ½ï¼š**
1. âœ… è‡ªå‹•å•Ÿå‹• stockml conda ç’°å¢ƒ
2. âœ… åŸ·è¡Œå›æ¸¬ï¼ˆé©—è­‰æ˜¨æ—¥é æ¸¬ï¼‰
3. âœ… åŸ·è¡Œé›™è»Œç­–ç•¥åˆ†æï¼ˆä»Šæ—¥é æ¸¬ï¼‰
4. âœ… æ¸…ç† 30 å¤©å‰çš„èˆŠæ—¥èªŒ
5. âœ… æ‰€æœ‰è¼¸å‡ºè¨˜éŒ„åˆ° logs/daily_YYYYMMDD_HHMMSS.log

**æ‰‹å‹•æ¸¬è©¦ï¼š**
```bash
./run_daily.sh
```

**æŸ¥çœ‹åŸ·è¡Œæ—¥èªŒï¼š**
```bash
# å³æ™‚æŸ¥çœ‹æœ€æ–°æ—¥èªŒ
tail -f logs/daily_*.log

# æŸ¥çœ‹ cron åŸ·è¡Œè¨˜éŒ„
tail -f logs/cron.log

# åˆ—å‡ºæœ€è¿‘ 10 æ¬¡åŸ·è¡Œ
ls -lt logs/daily_*.log | head -10
```

### ç’°å¢ƒè®Šæ•¸æª¢æŸ¥

ç¢ºä¿ `.env` æª”æ¡ˆå·²æ­£ç¢ºè¨­ç½®ï¼š

```bash
# å¿…å¡«é …ç›®
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your_service_role_key

# é€šçŸ¥ï¼ˆé¸å¡«ï¼‰
TELEGRAM_BOT_TOKEN=your_token
TELEGRAM_CHANNEL_ID=your_channel_id
DISCORD_WEBHOOK_URL=your_webhook
SENDER_EMAIL=your_email@gmail.com
EMAIL_PASSWORD=your_app_password
TO_EMAILS=recipient1@example.com,recipient2@example.com
```

### æ’ç¨‹åŸ·è¡Œæµç¨‹

```
Cron è§¸ç™¼ (ä¾‹å¦‚ï¼š14:30)
         â†“
å•Ÿå‹• run_daily.sh
         â†“
è¼‰å…¥ conda stockml ç’°å¢ƒ
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚               â”‚
åŸ·è¡Œå›æ¸¬      åŸ·è¡Œé›™è»Œç­–ç•¥    æ¸…ç†èˆŠæ—¥èªŒ
(é©—è­‰æ˜¨æ—¥)    (é æ¸¬ä»Šæ—¥)    (ä¿ç•™30å¤©)
         â†“
è¨˜éŒ„åˆ° logs/daily_YYYYMMDD_HHMMSS.log
         â†“
ç™¼é€é€šçŸ¥ (Telegram/Discord/Email)
         â†“
å®Œæˆ
```

### æ—¥èªŒç®¡ç†

**æ—¥èªŒé¡å‹ï¼š**
- `logs/daily_*.log` - æ¯æ—¥åŸ·è¡Œä¸»æ—¥èªŒï¼ˆè‡ªå‹•ç”Ÿæˆæ™‚é–“æˆ³è¨˜ï¼‰
- `logs/cron.log` - Cron åŸ·è¡Œè¨˜éŒ„ï¼ˆåŒ…å«éŒ¯èª¤è¨Šæ¯ï¼‰
- `logs/app.log` - æ‡‰ç”¨ç¨‹å¼é‹è¡Œæ—¥èªŒ

**è‡ªå‹•æ¸…ç†ï¼š**
- è¶…é 30 å¤©çš„æ—¥èªŒæœƒè‡ªå‹•åˆªé™¤
- ä¿æŒ logs/ ç›®éŒ„æ•´æ½”

### å¸¸è¦‹å•é¡Œ

#### Q1: Cron åŸ·è¡Œå¤±æ•—ï¼Œæ‰¾ä¸åˆ° condaï¼Ÿ

**A:** ç¢ºä¿ `run_daily.sh` ä¸­ conda è·¯å¾‘æ­£ç¢ºï¼š
```bash
# æª¢æŸ¥æ‚¨çš„ conda å®‰è£è·¯å¾‘
which conda

# ä¿®æ”¹ run_daily.sh ç¬¬ 7 è¡Œ
source /home/human/miniconda3/etc/profile.d/conda.sh
```

#### Q2: ç’°å¢ƒæ²’æœ‰æ­£ç¢ºå•Ÿå‹•ï¼Ÿ

**A:** æ‰‹å‹•æ¸¬è©¦ç’°å¢ƒå•Ÿå‹•ï¼š
```bash
source /home/human/miniconda3/etc/profile.d/conda.sh
conda activate stockml
python --version  # ç¢ºèª Python ç‰ˆæœ¬
pip list | grep tensorflow  # ç¢ºèªå¥—ä»¶å®‰è£
```

#### Q3: å¦‚ä½•ç¢ºèª Cron è¨­ç½®æˆåŠŸï¼Ÿ

**A:** æª¢æŸ¥ crontab åˆ—è¡¨ï¼š
```bash
crontab -l
```

#### Q4: å¦‚ä½•æš«åœè‡ªå‹•åŸ·è¡Œï¼Ÿ

**A:** è¨»è§£æ‰ crontab ä¸­çš„è¡Œï¼š
```bash
crontab -e
# åœ¨è¡Œé¦–åŠ ä¸Š # è¨»è§£
# 30 14 * * 1-5 /home/human/stock-underdog-ml/run_daily.sh ...
```

#### Q5: åŸ·è¡Œæ™‚é–“å»ºè­°ï¼Ÿ

**A:** å»ºè­°æ™‚é–“ï¼š
- **å°è‚¡ç‚ºä¸»**ï¼š14:30ï¼ˆæ”¶ç›¤å¾Œ 30 åˆ†é˜ï¼Œæ•¸æ“šå·²æ›´æ–°ï¼‰
- **ç¾è‚¡ç‚ºä¸»**ï¼š06:30ï¼ˆç¾æ±æ™‚é–“æ”¶ç›¤å¾Œï¼Œå°ç£æ—©ä¸Šï¼‰
- **å…©è€…éƒ½åš**ï¼šè¨­ç½®å…©å€‹æ’ç¨‹åˆ†åˆ¥åŸ·è¡Œ

### ç›£æ§èˆ‡ç¶­è­·

**æª¢æŸ¥ç³»çµ±ç‹€æ…‹ï¼š**
```bash
# æŸ¥çœ‹ Cron æœå‹™ç‹€æ…‹
systemctl status cron

# æŸ¥çœ‹æœ€è¿‘åŸ·è¡Œçµæœ
tail -100 logs/cron.log | grep -E "(âœ…|âŒ|å®Œæˆ|å¤±æ•—)"

# æª¢æŸ¥è³‡æ–™åº«é€£ç·š
python -c "from database import SupabaseManager; db = SupabaseManager(); print('âœ… é€£ç·šæˆåŠŸ' if db.enabled else 'âŒ é€£ç·šå¤±æ•—')"
```

**æ•ˆèƒ½ç›£æ§ï¼š**
```bash
# æŸ¥çœ‹åŸ·è¡Œæ™‚é–“
grep "åŸ·è¡Œæ™‚é–“\|çµæŸæ™‚é–“" logs/daily_*.log | tail -20

# æŸ¥çœ‹é æ¸¬æ•¸é‡
grep "ç¬¦åˆæ¢ä»¶\|é æ¸¬å®Œæˆ\|é›™é‡ç¬¦åˆ" logs/daily_*.log | tail -10
```

---

## ğŸ“Š çµæœè§£è®€æŒ‡å—

å®Œæ•´çš„è¼¸å‡ºè§£è®€é‚è¼¯è«‹åƒè€ƒ **[explain.md](explain.md)**ï¼ŒåŒ…å«ï¼š
- å›èª¿é¡å‹åˆ¤è®€ï¼ˆMA60 vs MA120ï¼‰
- PE/PB ä¼°å€¼åˆ†æ
- LSTM é æ¸¬å¼·åº¦è©•ç´š
- ç¶œåˆæ±ºç­–çŸ©é™£
- é¢¨éšªç­‰ç´šåˆ†é¡ï¼ˆS/A/B/C/Dï¼‰

---
## ï¿½ğŸ“„ æˆæ¬Š

MIT License

## ğŸ‘¤ ä½œè€…

David (tbdavid2019)

## ğŸ™ è‡´è¬

- Yahoo Finance - è‚¡åƒ¹è³‡æ–™
- Supabase - è³‡æ–™åº«æœå‹™
- TensorFlow - LSTM æ¡†æ¶